name: inverse
layout: true
class: center, middle, inverse

---
### 考古学・文化財のためのデータサイエンス・サロンonline#01 
# オープンリソースによる遺跡地図作成実習 part1
2020/9/5
[Peatixイベントページ](https://peatix.com/event/1608341/view)
[JASOSRリポジトリページ](https://kotdijian.github.io/JASOSR/)

---
layout: false
###### 1
## 1.この実習の目的  

--

* 考古学・文化財の研究や利活用において地図は必要不可欠です  

--

* ウェブ上で情報を閲覧・検索可能な地図サービスが一般化しています  

--

* 一方で位置情報を含む多様な考古学・文化財データをオンラインで取得することも可能になっています  

--

* オンラインで取得したデータを、ウェブ地図サービス上で利用可能にするスキルを身につけましょう  

--

* それは自身の研究や業務のためのデータの整理・地図化だけでなく、普及公開にも役立つはずです!!  

--

#### チュートリアルの進め方

* 講師はスライドと実際の操作画面を切り替えながら手順を説明していきます

* 質問がある方は、_スタッフ_岩崎・勝部・egamiの3名あてにプライベートチャットで

--

#### 参加者アンケートにご協力ください
https://discordapp.com/channels/771610647997054976/771628100085612584/774432757278965801

---
###### 2
## 2.考古学研究のリソース

#### 調べる対象はべきどれだけあるのか?

--
1. NDL Search：タイトル=考古学 AND 出版地=日本, データベース=国立国会図書館オンライン, 資料種別=本, 所蔵館=国立国会図書館 or 他機関  

--
2. CiNii Books, タイトル=考古学, 資料種別=図書・雑誌, 言語種別=日本語  

--

|年代|NDL Search|CiNii Books|増加率N|増加率C|
|:---------:|:----:|:----:|:-----:|:-----:|
|～1950|283|430|---|---|
|1951～1960|148|167|---|---|
|1961～1970|186|250|125.7%|149.7%|
|1971～1980|408|537|219.4%|214.8%|
|1981～1990|631|820|154.7%|152.7%|
|1991～2000|951|1469|150.7%|179.1%|
|2001～2010|1696|1772|178.3%|120.6%|
|2011～2020|1308|1243|77.1%|70.1%|

---
###### 3
## 2.考古学研究のリソース
#### 10年ごとに1.2～2倍に増えている!!  

--

☞ 2010年代には減速しているけれど...  

--

#### 毎回、各自で集成・集計するの?  

--

☞ オープンに利用できるデータが整備されるといいよね!  

--

### この実習で得たスキルで作成したデータは公開・共有しよう!!  

---
###### 4
## 2.考古学研究のリソース2

#### 2020年の課題

* 実際にオンラインでアクセスできるリソースはどれか? どれほどあるのか?  

--
* 検索とアクセスにかかるコストは? それは必要なのか?　　

--
* 考古学系のデータベースは増えているけれど、地図・分布図作成のための空間データ基盤は?

--
* 参考
    * [日本旧石器学会「日本列島の旧石器時代遺跡」](http://palaeolithic.jp/data/index.htm)
    * [奈良文化財研究所「遺跡データベース」](http://mokuren.nabunken.go.jp/Iseki/index.html)
    * [奈良文化財研究所「古代地方官衙関係遺跡データベース」](http://mokuren.nabunken.go.jp/NCPstr/NCPstr.htm)
    * **奈良文化財研究所ではその他の遺跡データベースも公開しています**
    * [国立歴史民俗博物館「縄文・弥生集落データベース」](https://www.rekihaku.ac.jp/up-cgi/login.pl?p=param/jomo/db_param)
    * [国立歴史民俗博物館「東国板碑データベース」](https://www.rekihaku.ac.jp/doc/itabi.html)
    * [国立歴史民俗博物館「陶磁器出土遺跡データベース」](https://www.rekihaku.ac.jp/up-cgi/login.pl?p=param/boue/db_param)
    * [国立歴史民俗博物館「遺跡発掘調査報告書放射性炭素年代測定データベース」](https://www.rekihaku.ac.jp/up-cgi/login.pl?p=param/esrd/db_param)
    * [国立歴史民俗博物館「日本の遺跡出土大型植物遺体データベース」](https://www.rekihaku.ac.jp/up-cgi/login.pl?p=param/issi/db_param)
    * [文化庁「国指定文化財等データベース」](https://kunishitei.bunka.go.jp/bsys/index)

---
###### 5
## 2.考古学研究のリソース2

#### すぐ使えるデータベース

--
☞ 位置情報が整備されている→GISやウェブ地図サービスに読み込める

--

#### すぐ使えないデータベースは?

--

* 遺跡名・内容等の一覧のみ ☞ 位置情報を取得して追加・連結しよう!!

--

#### たとえば遺跡地図・遺跡台帳

--
「 国及び地方公共団体は、周知の埋蔵文化財包蔵地について、資料の整備その他その周知の徹底を図るために必要な措置の実施に努めなければならない」（文化財保護法95条）  

--

* 公開の程度は自治体によりさまざま、位置情報とその他の属性を一括して、再利用可能なかたちで取得できる事例は少ない  

---
###### 6
## 3.考古学データを位置情報・空間情報を軸にまとめると...

--
1. **考古学情報**：遺跡の位置、内容(時代・遺構・遺物の種類...)  

--

2. **地理情報**：地形・地質...  

--

3. **地図の上に、考古学情報と地理情報を重ねる。相互の関係を検討する...**  

--
    * 基礎地図の上に描画する：場所の確認  

--
    * 地形や地物との関係を知る  

--
    * その他の地理情報との関係を知る  
    
---
###### 7
## 4. GIS(地理情報システム)があるよね

* [GISとは…](https://www.gsi.go.jp/GIS/whatisgis.html)  

--

#### GISソフト、ちょっと難しい?

--

#### シンプルかつウェブブラウザのみで使えるものもあるよ(webGIS)

--
* **web GISとは?**

    * 個別のPCにソフトウェアをインストールせず、サーバー上で実行される  
    * ウェブブラウザだけで使える ⇔ インターネット接続は必要  

--
* ここでは「[ひなたGIS](https://hgis.pref.miyazaki.lg.jp/hinata/) 」を使います
    * GISの理解・導入に適している  
    * 自分で操作できる、シンプルなデータファイル(.csv)で利用できる  

---
###### 8
## 5.手順
* リストを作る ☞ **実習1**
    * 今日は「[東京都遺跡地図情報インターネット提供サービス](https://tokyo-iseki.metro.tokyo.lg.jp/)」を利用します  

    * 位置情報として「住所」を利用します

--

* ひなたGISに読み込む

--

* 詳細な位置情報を付与する

--

* ひなたGISで位置座標の一覧を取得する ☞ **実習2・3**  

--

* 位置座標付きの一覧リストの完成!

--

* データの検索・編集 ☞ **実習4**

--

* ひなたGISなどに読み込む

--

* 背景地図の変更など ☞ **実習5**

---
###### 9
## 実習その1
### 1. データソースの確認と検索


--

1. 「[東京都遺跡地図情報インターネット提供サービス](https://tokyo-iseki.metro.tokyo.lg.jp/)」を開く

--

2. 利用条件に同意、地図画面へ

--

3.遺跡名、所在地、時代などにより検索・選択

--

4.遺跡を選択（地図画面下のリストor地図画面上で直接）

--

5.「詳細」をクリックして情報を表示

--

6.表示情報をコピー→スプレッドシートに貼りつけ

--

7.データ配列方向の変換

--

8.作成したリストを.csv形式で保存

---
###### 10
## 6. IDについて

--
* UID：ひとつのレコードを他と区別する、識別子  

--
* 遺跡データベースのUIDは何か?  

    * ユニークな、他と重複しない、一意の記号や番号  
--

* ×遺跡名：重複がある 文字の表記ゆれ?  
* ×遺跡番号：区市町村ごとに繰り返す...  
* ×区市町村名+遺跡番号：合併、名称の変更...  

---
###### 11
## 7. なぜUIDが必要なのか?  
* 複数のリストを参照、比較、統合するときに、照合、重複や欠損のチェックをどのように行なうか?  
    ☞ 分担したリストをつなげる  
    * 同じ自治体の中 ＜＞　複数の自治体をつなげる  

--
* 並べ替えをする、数を数える

--
* 他の情報とつなぐ

---
##### 12
## 8. JASIDについて

--
* **自治体コード**：総務省が定めた自治体のUID  
    * **重複はなく恒久的(とされる)**  
    * 参考：J-LIS地方公共団体情報システム機構「[地方公共団体コード住所](https://www.j-lis.go.jp/spd/code-address/jititai-code.html)」  

--
* **☞ 自治体コード+遺跡番号 !!**

--

    * サンプルデータにはJASIDとして追加してあります(枝番処理済み)  

---
###### 13
### **注意事項**
* 文字のエンコード：スプレッドシート（やその他多くのソフト、ウェブページ等）はUTF-8です  

    * 東京遺跡地図にはUTF-8と互換性のない文字が含まれています（"No." U+2116，ローマ数字，その他記号，一部の漢字)  

* /, [], () などの正規表現に使用される記号はプログラム処理の際に影響する場合があります

--
* セル内の改行記号、カンマはデータ書き出し時に問題を生じます  

--

* セルの結合を行うと不整なデータとなります  

---
###### 14
## 実習その2  
### ひなたGISによる位置座標の取得  

--

1.保存したcsv（その1-8）をテキストエディタで開き、「所在地」の列名を「変換元住所」に変更します

--

2.保存したファイルをメモ帳などテキストエディタで開きます  

--

3.文字コードをShift-JIS（Windowsメモ帳ならANSI）に指定して保存します

--

4.[ひなたGIS](https://hgis.pref.miyazaki.lg.jp/hinata/)を開きます

--

5.地図画面に遷移し保存した.csvファイルをドロップします

--

6.東京都遺跡地図を参照して正しい位置にプロットします

--

7.任意の場所を右クリック→表示されるメニューの「ファイル」→「csvを保存」

---
###### 15
## 9. テキストの文字コード・エンコード  

* 日本語文字コードの問題

--

    * 世界的にはユニコード([Unicode](https://ja.wikipedia.org/wiki/Unicode))が統一規格になりつつある  
    ☞ 日本では1990年代にシフトJISが確立されWindowsを中心に多用されていた(いる)  
    　 いまでも多くのソフト、ウェブサイトなどがシフトJISでエンコードされている。ユニコードと互換性がない場合がある  
--
    → 今回で言えば「ひなたGIS」はシフトJIS、GoogleスプレッドシートはUTF-8(ユニコード)  

--

* 将来的にはユニコードに統一されることが望ましい　＜　半角カナ、環境依存文字はやめよう

---
###### 16
### Mac-OSユーザー向け

* プラグイン不要でShift-JIS変換できるテキストエディタとして以下のものがあるようです

    * CotEditor(https://coteditor.com/)  
    
    * mi(https://www.mimikaki.net/)
    
    * MacVim(https://github.com/splhack/macvim-kaoriya)
    
    * （講師はMac-OS環境をエミュレートできないので詳細確認できません。ごめんなさい）
    
---
###### 17
## 10. ジオコーディング
#### 東京都遺跡地図からのデータには位置情報（緯度経度）がないはず?!

--

* なぜ、ひなたGISで位置が表示されるのか?

--

* [ジオコーディングとは](https://ja.wikipedia.org/wiki/%E3%82%B8%E3%82%AA%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0): 地名・住所などから位置座標を取得する  

* 参考: [Geocoding.jp](https://www.geocoding.jp/)  

--

* その解像度は町丁単位の代表点

--

* 東京都遺跡地図の場合、一覧データの住所表記の解像度が低いので同一地点に複数の遺跡が表示される

--

* ひなたGIS上で精確な位置情報を与える必要性

---
###### 18
## 11. なぜ「ひなたGIS」なのか

--

#### 同じ作業は「地理院地図」でもできます!!

--

* できるけど、ファイルの書き出し形式が...GeoJSONなので...

--

* エディタ、スプレッドシート上で簡単に編集できる.csvが使える方がいいかなぁ、と

---
###### 19
## 12. 重要：座標数値の表記

--

* 緯度・経度の表記は小学校の社会科以降、60進法の度分秒（° ′ ″）  

--

    ⇔ コンピュータのシステムはほぼすべて10進法表記（内部では2進法→16進法）  

--

* ウェブ上の各種地図サービスやGISでは60進法と10進法の2つの表記に対応している場合もある  

--

    ⇔ データは基本的に10進法で取り扱われる  

--

** ただし「度」は従来通り、北緯・南緯0～90度、東経・西経0～180度となる**  

    1. 10進法による緯度経度座標の表記では、整数部分は「度」、60進法による表記と一致する  
    2. 小数部分は、「分」「秒」を10進変換したもの  
    例1) 25分は0.4度です（25/60=0.4）  
    例2) 16秒は0.0044...度です（16/60/60=16/3600=0.0044...）  
    例3) 25分16秒は0.4044...度です  
    **0.2516または0.25.16とは表記しません**  

---
###### 20
### 13. GISにおける縮尺と位置情報の解像度  

--

#### ズームレベル  

--

* GISやウェブ地図サービスでは、紙地図の縮尺に対応する概念としてズームレベルが定義されている

--

* ズームレベルは各種ソフトやウェブサービスで共通
    * 参考：https://www.wingfield.gr.jp/archives/5777

--

* 対象地域の状況（都市か山岳地帯か）や対象物のサイズにより適切なズームレベルを選択すること

--
#### 位置情報の解像度
* 日本付近では緯度経度1秒の実距離は25～30m四方に相当  
    * 参考：https://say-no.hatenadiary.org/entry/20110626/1309106165

--

* 座標数値を秒の単位の整数値とすると上記の幅を含むことになる ☞ 桁数に注意

---
###### 21
### 14. 測地系について
* **重要** ：2002年の測量法改正に伴い、日本における測量・位置計測はITRF座標系GRS80楕円体に準拠すると規定された。通称「世界測地系」と呼ばれ、GNSS(GPS)測位などで用いられるWGS84座標系とほぼ一致する

* これにより2002年以降の埋蔵文化財調査等における基準点測量も世界測地系に移行している。しかしながら2002年以降の成果・刊行物にも、以前の座標系（日本測地　　　系）を採用しているものが散見される。2002年以前については日本測地系のものがほとんど

* 測地系が明記されていない場合、報告書等に記載の緯度経度情報では正しい位置にプロットすることができない場合がある

* 日本測地系と世界測地系のずれは場所により異なるが数秒～十数秒になるので、実距離では200～300m程度のずれが生じる  
    * 参考：https://www.drm.jp/jisx0410/JisGridSystem_1_Geoid.html
　　
* 測地系が不確かな場合は、座標ではなく地図上の位置等を参考に修正する必要がある

---
###### 22
## 実習その3
### 位置情報のないデータの作成等

--

1.ひなたGISの画面上で任意の場所を右クリック→「選択してください」→「点」

--

2.→位置座標を取得したい位置をクリックします

--

3.遺跡番号、遺跡名等の属性情報を追加する場合は赤色の「属性」ボタンをクリック、必要項目を入力

--

4.点データは実習2と同じ方法で.csvに書き出し可能

--

5.線、面（多角形）を描画することも可能。ただし線や面はGeoJSON形式で書き出し保存することになります

--

6.作成した点、線、面データは、背景地図の設定と合わせてサーバーに保存しURLとして共有することも可

* 任意の点等を右クリック→ファイル→サーバー保存を選択

* 保存完了のメッセージが出たらURLをコピー取得します

---
###### 23
## 実習その2・3の後で
### ひなたGISで取得した位置情報をもとのリストに結合する

--

1. ひなたGISから保存した.csvファイルで置き換える

--

* もちろんこれでOK!!

--

* ただしShift-JIS⇔UTF-8変換で文字化けする場合あり **☞ 情報が欠損するかも**

--

* IDでソートして位置座標だけコピーするのも良いかもしれません **データの対応に注意!!**

--

* 単独ないし少数のデータはひなたGISから直接コピペできる

    * 位置を取得したい点のマーカーを右クリック →
    
    * 表示される情報の緯度経度数値をクリック →
    
    * 画面左上に開く「座標等」ウィンドウの「epsg4326(WGS84)」の数値をコピー

---
###### 24
## 実習その4
### 主題図データの作成

--

* あらたに作成したリストから、作成したい主題図用のデータを抽出します

--

1. sample02.csvをスプレッドシート(Excel)で開きます

* 「ファイル」→「インポート」→「アップロード」→sample02.csvを選択、またはドロップ

--

2.**データが重く動作が遅い／停止する場合は、データ量を減じたsample03.csvを使用してください**

* **注意事項**: Microsoft Excelの場合、sample02.csv(or 03.csv)をダイレクトに開くと文字化けします(エンコード=UTF-8のため)

*→「データ」→「テキストまたはCSVから」→フォルダとファイルを指定→

* 「元のファイル」でエンコードを指定(65001: Unicode(UTF-8))→「読み込み」

---
###### 25
## 実習その4
### 主題図データの作成
3.【時代】の列でフィルターを設定します

* スプレッドシートの場合:【時代】列を選択→フィルターボタンをクリック→  

* 1行目の列名の横に表示される▼をクリック（フィルターを起動）→

* 「条件でフィルター」→「次を含むテキスト」を選択→「値または数式」に時代を入力

* Microsoft Excelの場合:「ホーム」→「並べ替えとフィルター」→「フィルター」→

* 列名【時代】の横に表示される▼をクリック（フィルターを起動）→「テキストフィルター」→

* 「指定の値を含む」→「オートフィルター オプション」の「抽出条件の指定：時代」に時代を入力

---
###### 26
## 実習その4
### 主題図データの作成

* 東京都遺跡地図の時代区分は、旧石器、縄文、弥生、古墳、奈良、平安、中世、近世と不明の9項目

* 種別、主な遺構、主な出土品でフィルターをかけることで異なる分布図を作成できます

* フィルターを重ねることも可能　
    * 例1)「時代：縄文時代を含む」×「種別：貝塚」
    * 例2) 「時代：中世を含む」×「主な出土品：銭を含む」etc.

--

4.フィルターされた一覧表の全体をコピー→新しいシートに貼り付けます

--

5.新しいシートを.csvで書き出し保存します。

---
###### 27
## 実習その4
### 主題図データの作成

6.必要に応じてUTF-8→Shift-JISに変換します。手順は実習2と同じです

* スプレッドシートの場合: .csvファイルはUTF-8で書き出されます。Shift-JISへの変換が必要です

* Microsoft Excelの場合: .csvファイルはShift-JISで書き出されます。ひなたGISへはそのまま読み込めます

--

7.Shift-JISに変換した.csvファイルを「ひなたGIS」に読み込み表示させます

---
######28
## 実習その4
### 主題図データの作成その2

--

* 複数属性データを色分け表示する

--

1. フィルター→新しいシートへ貼り付け

--

2. 「色」列を追加

--

3. もう一度フィルター → 属性ごとに「色」列にパラメータを設定

--

4.新しいシートを.csvで書き出し保存します。

--

5.必要に応じてUTF-8→Shift-JISに変換します。手順は実習2と同じです

* スプレッドシートの場合: .csvファイルはUTF-8で書き出されます。Shift-JISへの変換が必要です

*Microsoft Excelの場合: .csvファイルはShift-JISで書き出されます。ひなたGISへはそのまま読み込めます

--

6.Shift-JISに変換した.csvファイルを「ひなたGIS」に読み込み表示させます

---
######27
## 実習その５
### 背景地図の選択

--

1. 実習4で作成した地図をもとに背景に表示する地図を切り替えます

--

2.ひなたGIS画面右上の赤色の「背景」をクリック→表示したい地図等を選択します

--

3.複数の地図を重ね合わせ、前面の地図を透過させることも可能です

--

4.地図上の任意の点を右クリック→「効果」から、ヒートマップやバッファーを表示することも可能です

---
######28
## 15 応用事例
### 地理院地図・Googleマイマップなどを利用する

--

* .csv形式で位置座標をもつ一覧は、他のウェブGISや地図サービスで利用できます

--

* 住所情報が利用できる場合もあります

--

#### [地理院地図](https://maps.gsi.go.jp/)

--

* ひなたGIS同様多様な背景地図を利用できる
--

* レイヤーを設定できる

--

* データ書き出しはGeoJSON

--

#### [Googleマイマップ](https://www.google.co.jp/intl/ja/maps/about/mymaps/)

--

* Googleスプレッドシートから直接読み込める

--

* Googleマップ・アプリの機能を利用できる

--

* 参考：[東京都中世城館マップ](https://bit.ly/366VxUg)

--

### シンプルなデータはいろいろ活用できます!

---
######29
## 本日の実習は以上です

--

#### でも...
--
**「おれたちの戦いはこれからだ!!!!」**

--

* 作成したデータをもとに、分析や地図表示に必要なデータを作ろう!!

--

* そのデータで空間分析を実施しよう!!

--

* データと分析結果を地図化しよう!!

--

#### 続きもオンラインワークショップでやってます

* 考古学・文化財のためのデータサイエンス・サロンonline #04
    * オープンリソースによる遺跡地図作成実習 part3

    * データ操作と地図化をRにやらせちゃいます
    
    * 参加申し込みは[こちら](https://peatix.com/event/1690505/view)

---
###### 30
### 参考文献


* 奈良文化財研究所 2019 『デジタル技術による文化財情報の記録と利活用』奈良文化財研究所研究報告21 ([全国遺跡報告総覧](https://sitereports.nabunken.go.jp/ja/33189)／[奈文研リポジトリ](https://repository.nabunken.go.jp/dspace/handle/11177/6882))  

* 奈良文化財研究所 2020 『デジタル技術による文化財情報の記録と利活用2』奈良文化財研究所研究報告24 ([全国遺跡報告総覧](https://sitereports.nabunken.go.jp/ja/69974)／[奈文研リポジトリ](https://repository.nabunken.go.jp/dspace/handle/11177/6950))  

* 野口　淳 2020 「赤色立体図で見る東京の四万年―多摩川左岸の遺跡分布の動向を探る」『多摩のあゆみ』179([ADEACデジタルアーカイブ](https://trc-adeac.trc.co.jp/WJ11E0/WJJS06U/1392015100/1392015100100020/ht000060))

